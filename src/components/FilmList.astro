---
import FilmCard from './FilmCard.astro';

let data = [];

try {
	const res = await fetch(
		'https://script.google.com/macros/s/AKfycbxC2poXlqKExvGm9LJsG69Pf76-At2xpPuIfOfP_lG9bumOeQI9HS2aXd1xBWMnLPXt/exec',
		{
			cache: 'no-store', // Voorkom caching
		}
	);

	if (res.ok) {
		const json = await res.json();
		data = json.data || [];
	} else {
		console.warn('FilmList: Failed to fetch data, status:', res.status);
	}
} catch (error) {
	console.error('FilmList: Error fetching data:', error);
	data = [];
}

// console.log('ðŸš€ ~ data:', data);
---

<div class="filmlist relative z-50">
	<h2 class="pt pt-vw-96-max@2xl pb-2 text-8xl">Filmography</h2>
	<!-- <div class="sticky top-0 z-20 min-h-svh md:min-h-screen films">
		<Image
			src={bgImage}
			width={bgImage.width / 2}
			densities={[1.5, 2]}
			class="absolute top-0 h-full w-full object-cover"
			alt="Hero Image"
		/>
	</div> -->
	<div class="relative filmwrap overflow-hidden top-0 z-50">
		{
			data && data.length > 0 ? (
				data.map((i) => <FilmCard data={i} />)
			) : (
				<p class="p-4 text-sm">Filmography data wordt geladen...</p>
			)
		}
	</div>
</div>

<div id="contact" class="h-full"></div>

<style is:global>
	.filmlist {
		border-top: 2px var(--text) solid;
		background: var(--bg) !important;
		color: var(--text) !important;
	}

	.filmlist h2 {
		font-family: var(--font-brand);
		text-transform: uppercase;
		color: var(--text) !important;
	}

	.filmwrap {
		overflow: hidden;
		background: var(--bg);
		color: var(--text) !important;
	}

	.filmwrap p {
		color: var(--text) !important;
	}
</style>

<script>
	import { gsap } from 'gsap';
	import { ScrollTrigger } from 'gsap/ScrollTrigger';

	gsap.registerPlugin(ScrollTrigger);

	// Animate film cards with stagger when they come into view
	const cards = document.querySelectorAll('.filmcard');

	if (cards.length > 0) {
		gsap.fromTo(
			cards,
			{
				y: 20,
				opacity: 0,
			},
			{
				y: 0,
				opacity: 1,
				duration: 0.8,
				stagger: 0.1,
				ease: 'power2.out',
				scrollTrigger: {
					trigger: '.filmwrap',
					start: 'top 85%',
					toggleActions: 'play none none none',
				},
			}
		);
	}
</script>
